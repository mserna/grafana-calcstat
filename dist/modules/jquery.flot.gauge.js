!function(a){function b(a){return"undefined"!=typeof Logger?new Logger(a):null}function c(a,b){return b%a}function d(a,b){return Math.floor(b/a)}function e(a){return a*Math.PI}function f(a,b,c,d,e,f,g,h,i,j){if(f!==g){a.save(),a.beginPath(),a.arc(b,c,d,f,g,!1),a.lineTo(b+(d-e)*Math.cos(g),c+(d-e)*Math.sin(g)),a.arc(b,c,d-e,g,f,!0),a.closePath(),i&&(a.lineWidth=i),h&&(a.strokeStyle=h,a.stroke()),j&&(a.fillStyle=j,a.fill()),a.restore()}}function g(c){c.hooks.processOptions.push(function(a,c){b(c.series.gauges.debug);c.series.gauges.show&&(c.grid.show=!1,c.legend.show=!1),c.series.gauges.threshold.values.sort(function(a,b){return a.value<b.value?-1:a.value>b.value?1:0})}),c.hooks.draw.push(function(c,d){var e=c.getOptions(),f=e.series.gauges;b(f.debug);if(f.show){var g=c.getData();if(g&&g.length){var i=new h(c,d),j=i.calculateLayout();f.debug.layout,i.drawBackground(j);for(var k=0;k<g.length;k++){var l=g[k],m=a.extend({},f,l.gauges);l.gauges&&i.calculateAutoValues(m,j.cellWidth);var n=i.calculateCellLayout(m,j,k);i.drawCellBackground(m,n),m.debug.layout,m.label.show&&i.drawLable(m,j,n,k,l),i.drawGauge(m,j,n,l.label,l.data[0][1]),m.threshold.show&&i.drawThreshold(m,j,n),m.threshold.label.show&&i.drawThresholdValues(m,j,n,k),m.value.show&&i.drawValue(m,j,n,k,l)}}}})}var h=function(){function g(a,b){"auto"===a.gauge.width&&(a.gauge.width=Math.max(5,b/8)),"auto"===a.label.margin&&(a.label.margin=Math.max(1,b/20)),"auto"===a.label.font.size&&(a.label.font.size=Math.max(5,b/8)),"auto"===a.value.margin&&(a.value.margin=Math.max(1,b/30)),"auto"===a.value.font.size&&(a.value.font.size=Math.max(5,b/9)),"auto"===a.threshold.width&&(a.threshold.width=Math.max(3,b/100)),"auto"===a.threshold.label.margin&&(a.threshold.label.margin=Math.max(3,b/40)),"auto"===a.threshold.label.font.size&&(a.threshold.label.font.size=Math.max(5,b/15))}function h(a,b){for(var c,d=0;d<a.threshold.values.length;d++){var e=a.threshold.values[d];if(c=e.color,b<e.value)break}return c}function i(a,b,c){var d=a.gauge.startAngle+(a.gauge.endAngle-a.gauge.startAngle)*((c-a.gauge.min)/(a.gauge.max-a.gauge.min));return d<a.gauge.startAngle?d=a.gauge.startAngle:d>a.gauge.endAngle&&(d=a.gauge.endAngle),d}function j(a,b,c,d,e,g,h,i,j,k){e!==g&&(m.save(),f(m,a,b,c,d,e,g,h,i,j),k&&(f(m,a,b,c,d,e,g),m.clip(),m.shadowOffsetX=0,m.shadowOffsetY=0,m.shadowBlur=10,m.shadowColor="gray",f(m,a,b,c+1,d+2,e,g,h,1)),m.restore())}function k(a,b,c,d,f,g){l(c.cx+(b.thresholdLabelMargin+b.thresholdLabelFontSize/2+b.radius)*Math.cos(e(g)),c.cy+(b.thresholdLabelMargin+b.thresholdLabelFontSize/2+b.radius)*Math.sin(e(g)),"flotGagueThresholdValue"+d,a.threshold.label.formatter?a.threshold.label.formatter(f):f,a.threshold.label,g)}function l(b,c,d,e,f,g){var h=a("."+d,n),i=h.length;i||(h=a("<span></span>"),h.attr("id",d),h.css("position","absolute"),h.css("top",c+"px"),f.font.size&&h.css("font-size",f.font.size+"px"),f.font.family&&h.css("font-family",f.font.family),f.color&&h.css("color",f.color),f.background.color&&h.css("background-color",f.background.color),f.background.opacity&&h.css("opacity",f.background.opacity),n.append(h)),h.text(e),h.css("left",b+"px"),h.css("left",parseInt(h.css("left"))-h.width()/2+"px"),!i&&g&&(h.css("top",parseInt(h.css("top"))-h.height()/2+"px"),h.css("transform","rotate("+(180*g+90)+"deg)"))}var m,n,o,p,q,r,s=function(a,c){m=c,n=a.getPlaceholder(),o=a.getOptions(),p=o.series.gauges,q=a.getData(),r=b(p.debug)};return s.prototype.calculateLayout=function(){var a=n.width(),b=n.height(),c=Math.min(q.length,p.layout.columns),d=Math.ceil(q.length/c),f=p.layout.margin,h=p.layout.hMargin,i=p.layout.vMargin,j=(a-2*f-h*(c-1))/c,k=(b-2*f-i*(d-1))/d;if(p.layout.square){var l=Math.min(j,k);j=l,k=l}g(p,j);var m=p.cell.margin,o=0,r=0;p.label.show&&(o=p.label.margin,r=p.label.font.size);var s=0,t=0;p.value.show&&(s=p.value.margin,t=p.value.font.size);var u=0;p.threshold.show&&(u=p.threshold.width);var v=0,w=0;p.threshold.label.show&&(v=p.threshold.label.margin,w=p.threshold.label.font.size);for(var x=j/2-m-u-2*v-w,y=p.gauge.startAngle,z=p.gauge.endAngle,A=(z-y)/100,B=-1,C=y;C<z;C+=A)B=Math.max(B,Math.sin(e(C)));B=Math.max(B,Math.sin(e(z)));var D=(k-2*m-2*o-r)/(1+B);D*B<s+t/2&&(D=k-2*m-2*o-r-s-t/2);var E=D-2*v-w-u,F=Math.min(x,E),G=p.gauge.width;G>=F&&(G=Math.max(3,F/3));var H=2*v+w+u+F;return{canvasWidth:a,canvasHeight:b,margin:f,hMargin:h,vMargin:i,columns:c,rows:d,cellWidth:j,cellHeight:k,cellMargin:m,labelMargin:o,labelFontSize:r,valueMargin:s,valueFontSize:t,width:G,radius:F,thresholdWidth:u,thresholdLabelMargin:v,thresholdLabelFontSize:w,gaugeOuterHeight:Math.max(H*(1+B),H+s+t/2)}},s.prototype.calculateAutoValues=g,s.prototype.calculateCellLayout=function(a,b,e){var f=c(b.columns,e),g=d(b.columns,e),h=b.margin+(b.cellWidth+b.hMargin)*f,i=b.margin+(b.cellHeight+b.vMargin)*g,j=h+b.cellWidth/2,k=i+b.cellMargin+2*b.labelMargin+b.labelFontSize+b.thresholdWidth+b.thresholdLabelFontSize+2*b.thresholdLabelMargin+b.radius,l=b.cellHeight-2*b.cellMargin-2*b.labelMargin-b.labelFontSize-b.gaugeOuterHeight,m=0;return"middle"===a.cell.vAlign?m=l/2:"bottom"===a.cell.vAlign&&(m=l),k+=m,{col:f,row:g,x:h,y:i,offsetY:m,cellWidth:b.cellWidth,cellHeight:b.cellHeight,cellMargin:b.cellMargin,cx:j,cy:k}},s.prototype.drawBackground=function(a){p.frame.show&&(m.save(),m.strokeStyle=o.grid.borderColor,m.lineWidth=o.grid.borderWidth,m.strokeRect(0,0,a.canvasWidth,a.canvasHeight),o.grid.backgroundColor&&(m.fillStyle=o.grid.backgroundColor,m.fillRect(0,0,a.canvasWidth,a.canvasHeight)),m.restore())},s.prototype.drawCellBackground=function(a,b){m.save(),a.cell.border&&a.cell.border.show&&a.cell.border.color&&a.cell.border.width&&(m.strokeStyle=a.cell.border.color,m.lineWidth=a.cell.border.width,m.strokeRect(b.x,b.y,b.cellWidth,b.cellHeight)),a.cell.background&&a.cell.background.color&&(m.fillStyle=a.cell.background.color,m.fillRect(b.x,b.y,b.cellWidth,b.cellHeight)),m.restore()},s.prototype.drawGauge=function(a,b,c,d,f){var g=a.gauge.shadow.show?a.gauge.shadow.blur:0;j(c.cx,c.cy,b.radius,b.width,e(a.gauge.startAngle),e(a.gauge.endAngle),a.gauge.border.color,a.gauge.border.width,a.gauge.background.color,g);var k=h(a,f),l=i(a,b,f);j(c.cx,c.cy,b.radius-1,b.width-2,e(a.gauge.startAngle),e(l),k,1,k,g)},s.prototype.drawThreshold=function(a,b,c){for(var d=a.gauge.startAngle,g=0;g<a.threshold.values.length;g++){var h=a.threshold.values[g];c1=h.color,a2=i(a,b,h.value),f(m,c.cx,c.cy,b.radius+b.thresholdWidth,b.thresholdWidth-2,e(d),e(a2),c1,1,c1),d=a2}},s.prototype.drawLable=function(a,b,c,d,e){l(c.cx,c.y+c.cellMargin+b.labelMargin+c.offsetY,"flotGagueLabel"+d,a.label.formatter?a.label.formatter(e.label,e.data[0][1]):text,a.label)},s.prototype.drawValue=function(a,b,c,d,e){l(c.cx,c.cy-a.value.font.size/2,"flotGagueValue"+d,a.value.formatter?a.value.formatter(e.label,e.data[0][1]):text,a.value)},s.prototype.drawThresholdValues=function(a,b,c,d){k(a,b,c,"Min"+d,a.gauge.min,a.gauge.startAngle),k(a,b,c,"Max"+d,a.gauge.max,a.gauge.endAngle);for(var e=0;e<a.threshold.values.length;e++){var f=a.threshold.values[e];if(f.value>a.gauge.min&&f.value<a.gauge.max){var g=i(a,b,f.value);k(a,b,c,d+"_"+e,f.value,g)}}},s}(),i={series:{gauges:{debug:{log:!1,layout:!1,alert:!1},show:!1,layout:{margin:5,columns:3,hMargin:5,vMargin:5,square:!1},frame:{show:!0},cell:{background:{color:null},border:{show:!0,color:"black",width:1},margin:5,vAlign:"middle"},gauge:{width:"auto",startAngle:.9,endAngle:2.1,min:0,max:100,background:{color:"white"},border:{color:"lightgray",width:2},shadow:{show:!0,blur:5}},label:{show:!0,margin:"auto",background:{color:null,opacity:0},font:{size:"auto",family:"sans-serif"},color:null,formatter:function(a,b){return a}},value:{show:!0,margin:"auto",background:{color:null,opacity:0},font:{size:"auto",family:"sans-serif"},color:null,formatter:function(a,b){return parseInt(b)}},threshold:{show:!0,width:"auto",label:{show:!0,margin:"auto",background:{color:null,opacity:0},font:{size:"auto",family:",sans-serif"},color:null,formatter:function(a){return a}},values:[{value:50,color:"lightgreen"},{value:80,color:"yellow"},{value:100,color:"red"}]}}}};a.plot.plugins.push({init:g,options:i,name:"gauge",version:"1.1.0"})}(jQuery);